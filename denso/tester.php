<?php

// https://saibara.sakura.ne.jp/map/convgeo.cgi

$latitudes = [24.004351, 24.08767523218391, 24.170999464367817, 24.254323696551722, 24.33764792873563, 24.42097216091954, 24.50429639310345, 24.587620625287357, 24.670944857471262, 24.75426908965517, 24.83759332183908, 24.92091755402299, 25.004241786206897, 25.087566018390806, 25.17089025057471, 25.25421448275862, 25.33753871494253, 25.420862947126437, 25.504187179310346, 25.58751141149425, 25.67083564367816, 25.75415987586207, 25.837484108045977, 25.920808340229886, 26.004132572413795, 26.0874568045977, 26.17078103678161, 26.254105268965517, 26.337429501149426, 26.420753733333335, 26.50407796551724, 26.58740219770115, 26.670726429885057, 26.754050662068966, 26.837374894252875, 26.92069912643678, 27.00402335862069, 27.087347590804598, 27.170671822988506, 27.253996055172415, 27.33732028735632, 27.42064451954023, 27.503968751724138, 27.587292983908046, 27.670617216091955, 27.75394144827586, 27.83726568045977, 27.920589912643678, 28.003914144827586, 28.087238377011495, 28.1705626091954, 28.253886841379313, 28.337211073563218, 28.420535305747126, 28.503859537931035, 28.587183770114944, 28.670508002298853, 28.753832234482758, 28.837156466666666, 28.920480698850575, 29.003804931034484, 29.087129163218393, 29.170453395402298, 29.253777627586206, 29.337101859770115, 29.420426091954024, 29.503750324137933, 29.587074556321838, 29.670398788505747, 29.753723020689655, 29.837047252873564, 29.920371485057473, 30.003695717241378, 30.087019949425287, 30.170344181609195, 30.253668413793104, 30.336992645977013, 30.420316878160918, 30.50364111034483, 30.586965342528735, 30.670289574712644, 30.753613806896553, 30.836938039080458, 30.92026227126437, 31.003586503448275, 31.086910735632184, 31.1703477, 31.2535592, 31.33688343218391, 31.420207664367815, 31.503531896551724, 31.586856128735633, 31.67018036091954, 31.75350459310345, 31.836828825287355, 31.920153057471264, 32.00347728965517, 32.08680152183908, 32.17012575402299, 32.253449986206896, 32.3367742183908, 32.42009845057471, 32.503422682758625, 32.58674691494253, 32.670071147126436, 32.75339537931035, 32.83671961149425, 32.92004384367816, 33.00336807586207, 33.086692308045976, 33.17001654022989, 33.25334077241379, 33.336665004597705, 33.41998923678161, 33.503313468965516, 33.58663770114943, 33.66996193333333, 33.75328616551724, 33.83661039770115, 33.919934629885056, 34.00325886206897, 34.08658309425287, 34.169907326436785, 34.25323155862069, 34.336555790804596, 34.41988002298851, 34.50320425517241, 34.58652848735632, 34.66985271954023, 34.75317695172414, 34.83650118390805, 34.91982541609195, 35.003149648275866, 35.08647388045977, 35.169798112643676, 35.25312234482759, 35.33644657701149, 35.419770809195406, 35.50309504137931, 35.58641927356322, 35.66974350574713, 35.75306773793103, 35.836391970114946, 35.91971620229885, 36.003040434482756, 36.08636466666667, 36.16968889885057, 36.253013131034486, 36.33633736321839, 36.4196615954023, 36.50298582758621, 36.58631005977011, 36.669634291954026, 36.75295852413793, 36.836282756321836, 36.91960698850575, 37.00293122068966, 37.086255452873566, 37.16957968505747, 37.25290391724138, 37.33622814942529, 37.41955238160919, 37.502876613793106, 37.58620084597701, 37.669525078160916, 37.75284931034483, 37.83617354252874, 37.919497774712646, 38.00282200689655, 38.08614623908046, 38.16947047126437, 38.252794703448274, 38.336118935632186, 38.41944316781609, 38.5027674, 38.58609163218391, 38.66941586436782, 38.752740096551726, 38.83606432873563, 38.91938856091954, 39.00271279310345, 39.086037025287354, 39.169361257471266, 39.25268548965517, 39.33600972183908, 39.41933395402299, 39.5026581862069, 39.585982418390806, 39.66930665057471, 39.75263088275862, 39.83595511494253, 39.919279347126434, 40.002603579310346, 40.08592781149426, 40.16925204367816, 40.25257627586207, 40.33590050804598, 40.419224740229886, 40.50254897241379, 40.5858732045977, 40.66919743678161, 40.752521668965514, 40.835845901149426, 40.91917013333334, 41.002494365517244, 41.08581859770115, 41.16914282988506, 41.252467062068966, 41.33579129425287, 41.419115526436784, 41.502439758620696, 41.585763990804594, 41.669088222988506, 41.75241245517242, 41.835736687356324, 41.91906091954023, 42.00238515172414, 42.085709383908046, 42.16903361609195, 42.252357848275864, 42.335682080459776, 42.41900631264368, 42.502330544827586, 42.5856547770115, 42.668979009195404, 42.75230324137931, 42.83562747356322, 42.918951705747126, 43.00227593793103, 43.085600170114944, 43.168924402298856, 43.25224863448276, 43.335572866666666, 43.41889709885058, 43.502221331034484, 43.58554556321839, 43.6688697954023, 43.752194027586214, 43.83551825977011, 43.918842491954024, 44.002166724137936, 44.08549095632184, 44.16881518850575, 44.25213942068966, 44.335463652873564, 44.41878788505747, 44.50211211724138, 44.585436349425294, 44.6687605816092, 44.752084813793104, 44.835409045977016, 44.91873327816092, 45.00205751034483, 45.08538174252874, 45.168705974712644, 45.25203020689655, 45.33535443908046, 45.418678671264374, 45.50200290344828, 45.585327135632184, 45.668651367816096];

$longitudes = [122.87364, 122.9986399156, 123.1236289312, 123.2486179468, 123.3735869624, 123.498595978, 123.6235649936, 123.7485740092, 123.8735630248, 123.9985520404, 124.123541056, 124.2485100716, 124.3735190872, 124.4983681028, 124.6233571184, 124.748486134, 124.8734751496, 124.9984641652, 125.1233131808, 125.2483021964, 125.373431212, 125.4984202276, 125.6234092432, 125.7483982588, 125.8733872744, 125.99837629, 126.1233653056, 126.2483543212, 126.3733433368, 126.4983323524, 126.623301368, 126.7482903836, 126.8732793992, 126.9982884148, 127.1232574304, 127.248246446, 127.3732554616, 127.4982244772, 127.6232134928, 127.7482025084, 127.873191524, 127.9981805396, 128.0481695552, 128.2481585708, 128.3731675864, 128.498036602, 128.6228056176, 128.7478546332, 128.8728436488, 128.9978126644, 129.12298168, 129.2478906956, 129.3729597112, 129.4977687268, 129.6227577424, 129.747766758, 129.8727557736, 129.9977447892, 130.1227138048, 130.2477028204, 130.372691836, 130.4977608516, 130.6227298672, 130.7477188828, 130.8727078984, 130.997716914, 131.1226659296, 131.2476949452, 131.3726639608, 131.4976729764, 131.622641992, 131.7476110076, 131.8726000232, 131.9975890388, 132.1225780544, 132.24758707, 132.3725560856, 132.4224851012, 132.6224741168, 132.7474831324, 132.797452148, 132.9224411636, 133.0474301792, 133.2474191948, 133.2974282104, 133.497417226, 133.5473862416, 133.7473752572, 133.7973842728, 133.9224132884, 134.122362304, 134.2473913196, 134.2973803352, 134.4973693508, 134.5473783664, 134.747367382, 134.7973563976, 134.9223454132, 135.0473344288, 135.1723634444, 135.37219246, 135.4223414756, 135.6221704912, 135.7471595068, 135.8721485224, 135.922137538, 136.0472865536, 136.1722755692, 136.3722645848, 136.4970936004, 136.547082616, 136.6721916316, 136.8721806472, 136.9221696628, 137.1221586784, 137.247107694, 137.3721367096, 137.4221257252, 137.6221147408, 137.6720837564, 137.872072772, 137.9973217876, 138.0470308032, 138.1719398188, 138.2970888344, 138.42191785, 138.5470468656, 138.7468958812, 138.7970448968, 138.9970339124, 139.122022928, 139.1719119436, 139.2969009592, 139.4968899748, 139.5468789904, 139.671848006, 139.7968570216, 139.9218060372, 140.1218350528, 140.2468040684, 140.371793084, 140.4219020996, 140.5466911152, 140.6717401308, 140.7968491464, 140.921578162, 141.1218271776, 141.1715161932, 141.2966252088, 141.4970142244, 141.62144324, 141.745872256, 141.87118333333333, 141.994730288, 142.119159304];

$idxLat = [[0, 1018, 7], [2, 1035, 9], [3, 806, 7], [4, 366, 10], [5, 880, 0], [7, 896, 14], [8, 310, 19], [9, 721, 18], [16, 1110, 147], [20, 1095, 4], [21, 877, 66], [22, 1096, 6], [23, 1112, 13], [24, 232, 38], [25, 1076, 40], [26, 33, 38], [27, 1005, 37], [28, 1097, 32], [29, 206, 39], [30, 485, 41], [31, 1055, 43], [32, 553, 39], [35, 784, 40], [36, 780, 44], [38, 1147, 144], [39, 563, 45], [41, 1156, 154], [42, 1093, 153], [43, 1077, 48], [44, 441, 48], [46, 1117, 42], [47, 1056, 51], [48, 1081, 50], [49, 476, 50], [50, 667, 56], [51, 337, 52], [52, 675, 54], [57, 1098, 48], [61, 1051, 50], [65, 1052, 53], [68, 1071, 53], [69, 1015, 55], [72, 1121, 56], [74, 723, 61], [75, 643, 60], [76, 574, 63], [77, 1031, 58], [78, 400, 64], [80, 1103, 63], [81, 872, 65], [83, 605, 62], [84, 648, 60], [85, 670, 64], [86, 170, 63], [87, 198, 59], [88, 238, 65], [89, 393, 61], [90, 274, 67], [91, 42, 61], [92, 874, 55], [93, 528, 58], [94, 66, 67], [95, 1088, 43], [96, 195, 62], [97, 219, 68], [98, 333, 64], [99, 474, 56], [100, 136, 69], [101, 128, 61], [102, 291, 63], [103, 173, 58], [104, 29, 62], [105, 256, 65], [106, 325, 58], [107, 69, 60], [108, 307, 54], [109, 104, 56], [110, 37, 60], [111, 421, 89], [112, 181, 83], [113, 55, 61], [114, 13, 59], [115, 294, 80], [116, 68, 61], [117, 16, 63], [118, 119, 81], [119, 95, 66], [120, 56, 92], [121, 77, 86], [122, 35, 98], [123, 106, 99], [124, 10, 100], [125, 19, 87], [126, 80, 108], [127, 1, 100], [128, 26, 118], [129, 24, 94], [130, 7, 102], [131, 67, 105], [132, 30, 113], [133, 4, 111], [134, 57, 129], [135, 8, 133], [136, 70, 112], [137, 2, 132], [138, 0, 134], [139, 6, 136], [140, 5, 132], [141, 3, 134], [142, 18, 136], [143, 14, 132], [144, 45, 134], [145, 112, 138], [146, 20, 129], [147, 74, 135], [148, 47, 140], [149, 39, 136], [150, 122, 111], [151, 40, 113], [152, 315, 135], [153, 121, 136], [154, 135, 111], [155, 82, 143], [156, 126, 122], [157, 140, 127], [158, 61, 139], [159, 187, 125], [160, 260, 144], [161, 58, 127], [162, 413, 136], [163, 208, 143], [164, 32, 129], [165, 76, 140], [166, 157, 131], [167, 127, 137], [168, 569, 140], [169, 21, 143], [170, 407, 137], [171, 62, 139], [172, 436, 148], [173, 105, 146], [174, 141, 144], [175, 350, 140], [176, 90, 135], [177, 319, 144], [178, 193, 149], [179, 142, 145], [180, 212, 140], [181, 373, 149], [182, 108, 145], [183, 138, 140], [184, 810, 149], [185, 494, 137], [186, 81, 145], [187, 286, 151], [188, 88, 136], [189, 249, 145], [190, 351, 135], [191, 484, 148], [192, 223, 137], [193, 229, 140], [194, 209, 147], [195, 412, 146], [196, 323, 141], [197, 804, 142], [198, 84, 147], [199, 71, 140], [200, 99, 142], [201, 316, 139], [202, 437, 146], [203, 594, 142], [204, 517, 139], [205, 847, 143], [206, 284, 146], [207, 868, 148], [208, 580, 143], [209, 862, 136], [210, 584, 139], [211, 807, 137], [212, 582, 144], [213, 86, 142], [214, 1108, 137], [215, 490, 141], [216, 712, 160], [217, 564, 158], [218, 943, 135], [219, 159, 144], [220, 551, 155], [221, 321, 143], [222, 396, 162], [223, 113, 149], [224, 385, 143], [225, 124, 161], [226, 230, 149], [227, 9, 147], [228, 139, 149], [229, 481, 164], [230, 180, 151], [231, 462, 172], [232, 349, 156], [233, 360, 151], [234, 179, 152], [235, 389, 156], [236, 79, 155], [237, 495, 152], [238, 305, 170], [239, 470, 155], [240, 404, 165], [241, 572, 157], [242, 272, 155], [243, 401, 162], [244, 587, 160], [245, 651, 155], [246, 746, 158], [247, 833, 157], [248, 640, 152], [249, 571, 156], [250, 530, 151], [251, 644, 154], [252, 869, 155], [253, 714, 146], [254, 353, 150], [255, 805, 152], [257, 964, 150], [258, 998, 152]];

$idxLon = [[0, 880, 5], [4, 1095, 20], [5, 1047, 2], [6, 1096, 22], [7, 806, 3], [9, 956, 3], [10, 366, 4], [11, 1036, 7], [13, 1112, 23], [14, 896, 7], [18, 721, 9], [19, 310, 8], [30, 669, 26], [31, 1113, 31], [32, 1097, 28], [34, 905, 26], [35, 1087, 25], [37, 1005, 27], [38, 33, 26], [39, 206, 29], [40, 499, 26], [41, 485, 30], [42, 728, 32], [43, 1055, 31], [44, 780, 36], [45, 563, 39], [46, 334, 103], [47, 1016, 102], [48, 411, 105], [49, 672, 109], [50, 476, 49], [51, 539, 125], [52, 337, 51], [53, 89, 110], [54, 262, 105], [55, 443, 102], [56, 44, 104], [57, 299, 96], [58, 87, 110], [59, 13, 114], [60, 37, 110], [61, 42, 91], [62, 29, 104], [63, 16, 117], [64, 202, 109], [65, 117, 91], [66, 95, 119], [67, 66, 94], [68, 46, 110], [69, 136, 100], [70, 328, 108], [71, 107, 119], [72, 354, 122], [73, 115, 119], [74, 103, 122], [75, 355, 130], [76, 22, 124], [77, 102, 122], [78, 53, 117], [79, 134, 135], [80, 154, 122], [81, 119, 118], [82, 48, 124], [83, 172, 117], [84, 236, 129], [85, 73, 114], [86, 77, 121], [87, 19, 125], [88, 153, 131], [89, 60, 122], [90, 125, 136], [91, 370, 117], [92, 56, 120], [93, 217, 117], [94, 24, 129], [95, 194, 136], [96, 31, 127], [97, 165, 133], [98, 12, 127], [99, 106, 123], [100, 1, 127], [101, 205, 121], [102, 7, 130], [103, 324, 113], [104, 148, 130], [105, 67, 131], [106, 63, 143], [107, 120, 147], [108, 80, 126], [109, 38, 130], [110, 28, 135], [111, 4, 133], [112, 17, 130], [113, 30, 132], [114, 51, 129], [115, 144, 151], [116, 43, 128], [117, 301, 131], [118, 26, 128], [119, 143, 138], [120, 75, 144], [121, 83, 127], [122, 54, 151], [123, 25, 130], [124, 298, 157], [125, 59, 138], [126, 253, 155], [127, 50, 133], [128, 94, 147], [129, 20, 146], [130, 23, 139], [131, 15, 135], [132, 2, 137], [133, 8, 135], [134, 0, 138], [135, 74, 147], [136, 6, 139], [137, 127, 167], [138, 27, 138], [139, 61, 158], [140, 47, 148], [141, 92, 140], [142, 86, 213], [143, 21, 169], [144, 110, 171], [145, 81, 186], [146, 105, 173], [147, 9, 227], [148, 346, 196], [149, 113, 223], [150, 296, 194]];

$tpl = 'https://www.mapion.co.jp/f/mmail/send_mobile/SendMobile_map.html?lon=%s&lat=%s';

file_put_contents('latitudes.js', '');

foreach ($idxLat as $idx => $data) {

    $zone   = $data[1];
    $latidx = $data[0];
    $lonidx = $data[2];

    $latitude  = floatval($latitudes[$latidx]);
    $longitude = floatval($longitudes[$lonidx]);

    // if ($idx == 53) {
    echo 'zone:' . $zone . "\n";
    $get = sprintf($tpl, $longitude, $latitude);

    echo $get . "\n";

    $read = file_get_contents($get);
    file_put_contents('tester.html', $read);

    $re = '/input value="([\S\s]*?)"/m';
    preg_match_all($re, $read, $matches, PREG_SET_ORDER, 0);

    $parts = zoneParts($matches[0][1]);

    // print_r($parts);

    if (count($parts)) {

        // $block = intval($parts[1]);
        // $bdiff = floor($block / 30) * 0.004;

        // $unit  = intval($parts[2]);
        // $udiff = floor($unit / 30) * 0.00015;

        $score = intval($parts[3]);
        $sdiff = floor($score / 9) * 0.000015;

        // $latitude -= $bdiff;
        // $latitude -= $udiff;
        $latitude -= $sdiff;

        $get  = sprintf($tpl, $longitude, $latitude);
        $read = file_get_contents($get);
        file_put_contents('tester.html', $read);

        $re = '/input value="([\S\s]*?)"/m';
        preg_match_all($re, $read, $matches, PREG_SET_ORDER, 0);

        $parts = zoneParts($matches[0][1]);
        echo "calibrated\n";
        print_r($parts);

        if (count($parts) && ($zone == $parts[0])) {
            file_put_contents('latitudes.js', "{ $latidx : $latitude },\n", FILE_APPEND);
            echo $latidx . ' = ' . $latitude . "\n";
        }
        // }
        // exit;

    }
}
// file_put_contents('longitudes.js', '');

// foreach ($idxLon as $idx => $data) {

//     $zone   = $data[1];
//     $latidx = $data[2];
//     $lonidx = $data[0];

//     $latitude  = floatval($latitudes[$latidx]);
//     $longitude = floatval($longitudes[$lonidx]);

//     // if ($idx == 100) {
//     echo 'zone:' . $zone . "\n";
//     $get = sprintf($tpl, $longitude, $latitude);

//     echo $get . "\n";

//     $read = file_get_contents($get);
//     file_put_contents('tester.html', $read);

//     $re = '/input value="([\S\s]*?)"/m';
//     preg_match_all($re, $read, $matches, PREG_SET_ORDER, 0);

//     $parts = zoneParts($matches[0][1]);

//     print_r($parts);

//     $block = intval($parts[1]);
//     $bdiff = ($block % 30) * 0.005;

//     $unit  = intval($parts[2]);
//     $udiff = ($unit % 30) * 0.0002;

//     $score = intval($parts[3]);
//     $sdiff = ($score % 9) * 0.00002;

//     $longitude -= $bdiff;
//     $longitude -= $udiff;
//     $longitude -= $sdiff;

//     $get  = sprintf($tpl, $longitude, $latitude);
//     $read = file_get_contents($get);
//     file_put_contents('tester.html', $read);

//     file_put_contents('longitudes.js', "{ $lonidx : $longitude },\n", FILE_APPEND);
//     echo $lonidx . ' = ' . $longitude . "\n";

//     // exit;

// }

exit;

function zoneParts($str)
{

    if ($str == '') {
        return [];
    }

    list($full, $score) = explode('*', $str);
    $parts              = explode(' ', $full);

    // 000*55
    if (count($parts) == 1) {
        return ['0', '000', $parts[0], $score];
    }

    if (count($parts) == 2) {
        return ['0', $parts[0], $parts[1], $score];
    }

    return [$parts[0], $parts[1], $parts[2], $score];
}

// $wtp = " { zone:%s, from: { lat: %s, lon: %s }, to: { lat: %s, lon: %s } },\n";
